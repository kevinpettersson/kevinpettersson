name: Generate GitHub Stats

on: 
    push:
        branches:
            - main
            # ignore commits by the bot
        paths-ignore:
            - 'stats/**'
    schedule:
        - cron: '0 0 * * *'
    
jobs: 
    generate-stats:
        runs-on: ubuntu-latest

        steps: 
            - name: Checkout repository
              uses: actions/checkout@v3
              with:
                persist-credentials: false

            - name: Generate GitHub Stats card
              run: |
                mkdir -p stats
                # Download the GitHub stats card as a static image
                curl -o stats/github-stats.svg "https://github-readme-stats.vercel.app/api?username=${GITHUB_ACTOR}&show_icons=true&theme=radical"
                curl -o stats/github-top-langs.svg "https://github-readme-stats.vercel.app/api/top-langs/?username=${GITHUB_ACTOR}&layout=donut&theme=radical"
            - name: Commit and push
              run: |
                git config --local user.name "github-actions[bot]"
                git config --local user.email "github-actions[bot]@users.noreply.github.com"
                git add stats/github-stats.svg
                git commit -m "Update GitHub stats card" || echo "No changes to commit"
                git push https://$PAT_TOKEN@github.com/${{ github.repository }} HEAD:main
              env:
                PAT_TOKEN: ${{ secrets.PAT_TOKEN }}
                